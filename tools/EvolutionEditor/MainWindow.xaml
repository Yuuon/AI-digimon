<Window x:Class="EvolutionEditor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="数码宝贝进化表编辑器" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 工具栏 -->
        <ToolBar Grid.Row="0">
            <Button x:Name="BtnNew" Content="新建" Click="BtnNew_Click"/>
            <Button x:Name="BtnOpen" Content="打开" Click="BtnOpen_Click"/>
            <Button x:Name="BtnSave" Content="保存" Click="BtnSave_Click"/>
            <Separator/>
            <Button x:Name="BtnAdd" Content="添加数码宝贝" Click="BtnAdd_Click"/>
            <Button x:Name="BtnDelete" Content="删除选中" Click="BtnDelete_Click"/>
            <Separator/>
            <TextBlock x:Name="StatusText" VerticalAlignment="Center" Margin="10,0"/>
        </ToolBar>

        <!-- 主内容区 -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧列表 -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <TextBox x:Name="SearchBox" Grid.Row="0" Margin="5" 
                         TextChanged="SearchBox_TextChanged"
                         ToolTip="搜索数码宝贝"/>
                <ListBox x:Name="DigimonList" Grid.Row="1" Margin="5"
                         SelectionChanged="DigimonList_SelectionChanged"
                         DisplayMemberPath="Name"/>
            </Grid>

            <!-- 分隔条 -->
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" 
                          Background="LightGray"/>

            <!-- 右侧编辑区 -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="EditorPanel" Margin="10" IsEnabled="False">
                    
                    <!-- 基本信息 -->
                    <GroupBox Header="基本信息">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <Label Grid.Row="0" Grid.Column="0" Content="ID："/>
                            <TextBox x:Name="TxtId" Grid.Row="0" Grid.Column="1"/>
                            
                            <Label Grid.Row="0" Grid.Column="2" Content="名称："/>
                            <TextBox x:Name="TxtName" Grid.Row="0" Grid.Column="3"/>

                            <Label Grid.Row="1" Grid.Column="0" Content="阶段："/>
                            <ComboBox x:Name="CmbStage" Grid.Row="1" Grid.Column="1"/>
                            
                            <Label Grid.Row="1" Grid.Column="2" Content="性格："/>
                            <ComboBox x:Name="CmbPersonality" Grid.Row="1" Grid.Column="3"/>

                            <Label Grid.Row="2" Grid.Column="0" Content="外观："/>
                            <TextBox x:Name="TxtAppearance" Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="3"/>
                        </Grid>
                    </GroupBox>

                    <!-- 基础设定 -->
                    <GroupBox Header="基础设定（系统提示词）" Margin="0,10">
                        <TextBox x:Name="TxtBasePrompt" Height="100" 
                                 TextWrapping="Wrap" AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"/>
                    </GroupBox>

                    <!-- 进化选项 -->
                    <GroupBox Header="进化选项" Margin="0,10">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="200"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="双击编辑，右键删除" 
                                       Foreground="Gray" FontSize="12"/>
                            
                            <DataGrid x:Name="EvolutionGrid" Grid.Row="1" 
                                      AutoGenerateColumns="False"
                                      CanUserAddRows="True"
                                      SelectionMode="Single">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="目标ID" Binding="{Binding TargetId}" Width="*"/>
                                    <DataGridTextColumn Header="所需Token" Binding="{Binding MinTokens}" Width="80"/>
                                    <DataGridTextColumn Header="勇气" Binding="{Binding Requirements.Courage}" Width="60"/>
                                    <DataGridTextColumn Header="友情" Binding="{Binding Requirements.Friendship}" Width="60"/>
                                    <DataGridTextColumn Header="爱心" Binding="{Binding Requirements.Love}" Width="60"/>
                                    <DataGridTextColumn Header="知识" Binding="{Binding Requirements.Knowledge}" Width="60"/>
                                    <DataGridTextColumn Header="优先级" Binding="{Binding Priority}" Width="60"/>
                                    <DataGridTextColumn Header="描述" Binding="{Binding Description}" Width="*"/>
                                </DataGrid.Columns>
                            </DataGrid>

                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button x:Name="BtnAddEvo" Content="添加进化" Click="BtnAddEvo_Click"/>
                                <Button x:Name="BtnRemoveEvo" Content="删除进化" Click="BtnRemoveEvo_Click"/>
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- 预览 -->
                    <GroupBox Header="完整JSON预览" Margin="0,10">
                        <TextBox x:Name="TxtPreview" Height="150" IsReadOnly="True"
                                 TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                                 FontFamily="Consolas" FontSize="11"/>
                    </GroupBox>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- 状态栏 -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock x:Name="BottomStatus" Text="就绪"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
